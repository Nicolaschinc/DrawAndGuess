### 需求文档：AI 游戏主管 (AI Game Master) 功能
版本: 1.0 日期: 2026-02-24 负责人: AI 产品总监
 1. 背景与目标
1.1. 背景 (Background): 当前版本的“你画我猜”游戏依赖于一个固定的本地词库。这导致了两个主要问题：

- 内容陈旧: 长期游戏后，玩家会遇到重复的词语，降低了新奇感和趣味性。
- 游戏僵局: 当绘画者无法有效表达或词语本身较难时，游戏容易陷入无人能猜出的僵局，导致所有玩家的挫败感和不良体验。
1.2. 目标 (Goal): 引入一个名为“AI 游戏主管 (AI Game Master)”的智能系统，旨在：

- 提升趣味性: 通过动态、无限的词语供给，增加游戏的新鲜感和重玩价值。
- 降低挫败感: 在游戏陷入僵局时，通过智能提示打破僵局，提升玩家的参与感和成就感。
- 保证稳定性: 确保在任何情况下，游戏的核心玩法都能稳定运行。 2. 核心功能描述
2.1. AI 动态词语生成

- 描述: 系统将具备调用大语言模型（LLM）API 的能力，根据预设的指令（Prompt）动态生成符合游戏要求的词语。
- 实现方式: 采用 Prompt Engineering ，而非 Fine-tuning。Prompt 的设计应侧重于生成易于绘画、大众熟知且内容健康的词语。
- 技术要求: AI 返回的格式应为结构化的 JSON，例如： {"word": "词语", "category": "分类"} 。
2.2. AI 智能分级提示

- 描述: 在一轮绘画中，如果长时间无人猜中，系统将自动触发 AI，为所有猜词者生成并展示提示。
- 触发逻辑:
  - 首次提示: 游戏开始 20 秒 后无人猜中，触发第一次提示。
  - 二次提示 (可选): 游戏开始 40 秒 后仍无人猜中，触发第二次、更明确的提示。
- 提示要求: 提示应巧妙、有趣，引导玩家思考，而非直接泄露答案。 3. 词源混合策略 (Hybrid Word Source Strategy)
为了平衡创新与稳定，系统将采用“AI 优先，本地备用”的混合词源策略。

3.1. 运行模式配置

- 系统应提供一个服务器端配置项 WORD_SOURCE_MODE ，支持以下两种模式：
  - AI_PREFERRED (默认): 优先使用 AI 生成词语。当 AI 服务不可用时，自动降级至本地词库。
  - LOCAL_ONLY : 仅使用本地静态词库。此模式可用于无网络环境、成本控制或调试。
3.2. AI 优先模式下的工作流

1. 主路径: 系统优先从“词语预热池”中获取由 AI 生成的词语。
2. 降级路径: 在以下任一情况发生时，系统应 自动、无缝地 从本地静态词库中获取一个词语，以保证游戏不中断：
   - AI 服务 API 调用超时或返回错误。
   - AI 返回的内容未能通过服务器端的安全/合规性过滤。
   - “词语预热池”因未知原因变空。 4. 系统逻辑与用户流程
4.1. “词语预热池” (Word Pre-warming Pool) 机制

- 逻辑: 为消除 AI 调用延迟对用户体验的影响，服务器需在后台维护一个包含 5-10 个已生成词语的队列（预热池）。
- 流程:
  1. 当玩家需要新词时，系统从预热池头部取出一个词（响应时间 < 100ms）。
  2. 系统异步调用 AI 服务，将生成的新词补充到预热池尾部。
4.2. 用户路径 (User Journey)

- 绘画者: 开始绘画时，立即从预热池获得一个词语。
- 猜词者: 正常进行猜测。在预设的时间点（如 20s, 40s），在公共区域看到由 AI 提供的全局提示。 5. 非功能性需求 (Non-Functional Requirements)
- 5.1. 性能: 玩家获取词语的延迟必须低于 500ms，对用户无感知。
- 5.2. 可靠性: 系统必须具备完整的降级机制。AI 服务的任何故障都不能导致核心游戏流程中断。
- 5.3. 内容安全: 所有由 AI 生成并展示给用户的内容（词语、提示），必须经过服务器端的关键词黑名单过滤。
- 5.4. 成本监控: 需要有机制监控 AI API 的调用频率和成本，并设置告警阈值。 6. 验收标准 (Acceptance Criteria)
- AC1: 在 AI_PREFERRED 模式下，新一轮游戏的词语由 AI 动态生成。
- AC2: 游戏开始 20 秒后无人猜中，所有猜词者能看到第一条 AI 提示。
- AC3: 当 AI 服务被模拟为不可用（如断开网络）时，系统能自动从本地词库取词，游戏正常进行。
- AC4: 在服务器配置中将 WORD_SOURCE_MODE 切换为 LOCAL_ONLY 后，所有词语均来自本地词库。
- AC5: AI 生成的任何包含预设黑名单关键词的内容，都不会展示给玩家，并触发一次降级（从本地词库取词）。
- AC6: 从玩家点击“开始”到看到词语的整个过程，体感上是瞬时的。